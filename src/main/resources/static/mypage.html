<!doctype html>
<html lang="ko" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.88.1">
    <title> 오늘 뭐 먹지? </title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/album/">

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/mycss.css" rel="stylesheet">

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>
    <script src="../assets/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.0/font/bootstrap-icons.css" integrity="sha384-7ynz3n3tAGNUYFZD3cWe5PDcE36xj85vyFkawcF6tIwxvIecqKvfwLiaFdizhPpN" crossorigin="anonymous">
    <!--파비콘-->
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon2.ico"/>


    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <!-- 구글 폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&display=swap" rel="stylesheet">

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
        #page-container {
            position: relative;
            min-height: 100vh;
        }
        #content-wrap{
            padding-bottom: 2.5rem;
        }
        #footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 2.5rem;
        }

    </style>

    <script>

        $(document).ready(function () {
            $.ajaxPrefilter(function (options, originalOptions, jqXHR) {
                if (localStorage.getItem('token')) {
                    jqXHR.setRequestHeader('Authorization', 'Bearer ' + localStorage.getItem('token'));
                }
            });
            $("#logout").click(function () {
                //로그아웃
                localStorage.removeItem("token");
                localStorage.removeItem("username");
                location.href = '/';
            });
            //마이페이지 처음 출력 내가 추천받은 음식
            $.ajax({
                type: "GET",
                url: "/mypage",
                success: function (response) {
                    console.log(response)
                    // let temp = `
                    // <p>@${response['username']}</p>
                    // <p>${response['statusMessage']}</p>
                    // `
                    $("#username").html(response['username']);
                    $('#usercomment').html(response['statusMessage']);
                    let profile_pic = response['profilePhoto'];
                    $('#profile_pic').attr("src", profile_pic);
                    let temp_nav = `<div class="mypage-nav" style=" clear:left; margin-top: 30px;">
                                    <a href="#" style="text-decoration: none;  border-bottom: 2px solid; padding-bottom: 10px; color:black; margin-right: 12px; margin-left: 10px;"><strong>내가 추천받은 음식</strong></a>
                                    <a href="#" onclick="nav2();" style="text-decoration: none;color:black; margin-right: 12px; margin-left: 10px;"><strong>내가 추천한 음식</strong></a>
                                    <a href="#" onclick="nav3();" style="text-decoration: none;color:black; margin-right: 12px; margin-left: 10px;"><strong>내가 남긴 댓글</strong></a>
                                    <hr style="margin-top:8px;">
                                </div>
                                <div id="user-nav"></div>`
                    $('#user-table').append(temp_nav);
                    let postings = response["postings"];
                    for (let i = 0; i < postings.length; i++) {
                        let postingFoodName = postings[i]['postingFoodName']
                        let postingMemo = postings[i]['postingMemo']
                        let date = postings[i]['createdAt']
                        let temp = `
                    <p>내가 추천받은 음식 : ${postingFoodName},${postingMemo},,${date}</p>
                        `
                        $('#user-nav').append(temp);
                    }
                }
            })
        })
        //내가 추천받은 음식 클릭시
        function nav1() {
            $.ajax({
                type:"GET",
                url:"/mypage",
                success:function(response) {
                    console.log(response,"nav1에 뿌려질 정보");
                    $('#user-table').empty();
                    $('#user-nav').empty();
                    let temp_nav = `<div class="mypage-nav" style=" clear:left; margin-top: 30px;">
                                    <a href="#" style="text-decoration: none;  border-bottom: 2px solid; padding-bottom: 10px; color:black; margin-right: 12px; margin-left: 10px;"><strong>내가 추천받은 음식</strong></a>
                                    <a href="#" onclick="nav2();" style="text-decoration: none;color:black; margin-right: 12px; margin-left: 10px;"><strong>내가 추천한 음식</strong></a>
                                    <a href="#" onclick="nav3();" style="text-decoration: none;color:black; margin-right: 12px; margin-left: 10px;"><strong>내가 남긴 댓글</strong></a>
                                    <hr style="margin-top:8px;">
                                </div>
                                <div id="user-nav"></div>`
                    $('#user-table').append(temp_nav);
                    let postings = response["postings"];
                    for (let i = 0; i < postings.length; i++) {
                        let postingFoodName = postings[i]['postingFoodName']
                        let postingMemo = postings[i]['postingMemo']
                        let date = postings[i]['createdAt']
                        let temp = `
                        <p>내가 추천받은 음식: ${postingFoodName},${postingMemo},,${date}</p>
                        `
                        $('#user-nav').append(temp);
                    }
                }
            })
        }
        //내가 추천한 음식 클릭시
        function nav2() {
            $.ajax({
                type:"GET",
                url:"/mypage",
                success:function(response) {
                    console.log(response,"nav2에 뿌려질 정보");
                    $('#user-table').empty();
                    $('#user-nav').empty();
                    let temp_nav = `<div class="mypage-nav" style=" clear:left; margin-top: 30px;">
                                    <a href="#" onclick="nav1();" style="text-decoration: none;color:black; margin-right: 12px; margin-left: 10px;"><strong>내가 추천받은 음식</strong></a>
                                    <a href="#" style="text-decoration: none;  border-bottom: 2px solid; padding-bottom: 10px; color:black; margin-right: 12px; margin-left: 10px;"><strong>내가 추천한 음식</strong></a>
                                    <a href="#" onclick="nav3();" style="text-decoration: none;color:black; margin-right: 12px; margin-left: 10px;"><strong>내가 남긴 댓글</strong></a>
                                    <hr style="margin-top:8px;">
                                </div>
                                <div id="user-nav"></div>`
                    $('#user-table').append(temp_nav);
                    let postings = response["postings"];
                    for (let i = 0; i < postings.length; i++) {
                        let postingFoodName = postings[i]['postingFoodName']
                        let postingMemo = postings[i]['postingMemo']
                        let date = postings[i]['createdAt']
                        let temp = `
                                        <div style="width:275px; margin-left:5px; margin-right: 5px; border:1px solid gainsboro; border-radius: 5px; float: left">
                                            <div class="foodimage" style='width: 275px; height: 275px; border-top-left-radius: 5px; border-top-right-radius: 5px;
                                            /*background-image:url("/images/food_sample.jpg")*/ background-color: black' ;></div>
                                            <div class="foodinfo" style="width: 240px; padding: 20px;">
                                                <p style="font-size: 12pt; font-weight: bold; margin: 0 0 5px 0;">${postingFoodName}</p>
                                                <i class="bi bi-heart" id="heart" onclick="heart()"></i>
                                                <p style="font-size: 10pt; margin: 0px; line-height: 15pt;">${postingMemo}</p>
                                            </div>
                                        </div>
                        `
                        $('#user-nav').append(temp);
                    }
                }
            })
        }
        //내가 남긴 댓글 클릭시
        function nav3() {
            $.ajax({
                type:"GET",
                url:"/mypage",
                success:function(response) {
                    console.log(response,"nav3에 뿌려질 정보");
                    let postings = response["postings"];
                    for (let i = 0; i < postings.length; i++) {
                        let postingFoodName = postings[i]['postingFoodName']
                        let postingMemo = postings[i]['postingMemo']
                        let date = postings[i]['createdAt']
                        let temp = `
                        <p>내가 남긴 댓글 출력 : ${postingFoodName},${postingMemo},,${date}</p>
                        `
                        $('#user-nav').append(temp);
                    }
                }
            })
        }

        //포스팅 부분 테스트 나중에 삭제!
        function saveFoodRecomend() {
            let info = {
                "postingFoodName":$("#foodname").val(),
                "postingMemo":$("#comment").val(),
                "foodImgUrl":$("#foodurl").val(),
                "tag":$("#tagname1").val()
            }
            $.ajax({
                type:"POST",
                url:"/post",
                contentType: "application/json",
                data: JSON.stringify(info),
                success:function (response) {
                    alert("저장되었습니다!")
                    window.location.reload();
                }
            })
        }

        function heart() {
            if ($("#heart").hasClass("bi-heart")) {
                $("#heart").removeClass("bi-heart").addClass("bi-heart-fill");
                // $.ajax({
                //     type:"POST",
                //     url:"/liked",
                //     contentType: "application/json",
                //     data:JSON.stringify(link),
                //     success:function(response) {
                //         $('#좋아요숫자').empty();
                //         $.ajax({
                //             type:"GET",
                //             url:"/liked",
                //             success:function(response) {
                //                 let cnt = response['cnt']
                //                 $('#좋아요숫자').append(cnt);
                //             }
                //         })
                //     }
                // })
            } else {
                $("#heart").removeClass("bi-heart-fill").addClass("bi-heart");
            }
        }

    </script>

</head>
<body>
<div id="page-container">
    <header>
        <!--    네비게이션바-->
        <div class="navbar navbar-dark bg-dark shadow-sm">
            <div class="nav-container">
                <div class="nav-title-box">
                    <a href="#" class="title nav-text" style="padding-top: 5px;">오늘 뭐 먹지?</a>
                    <a href="/" class="nave-menu-text nav-menu">뭐먹을지 추천받기</a>
                    <a href="/" class="nave-menu-text nav-menu">맛있는거 추천받기</a>
                    <a href="/" class="nave-menu-text nav-menu">이세상 음식 전부보기</a>
                </div>
                <div class="nav-botton-box">
                    <button class="nav-button" id="logout">로그아웃</button>
                </div>
            </div>
        </div>
    </header>
    <main id="content-wrap">
        <div class="profile" style="width:852px; margin:auto;">
            <div style="margin:30px 20px 20px 20px;">
                <img style="width:70px; border-radius: 70px;  float:left; " src="/static/images/profile_pic.jpg" id="profile_pic">
            </div>
            <div style="margin-top:10px; margin-left:20px; float:left; ">
                <span>@<span id="username"></span><br/><span id="usercomment"></span>
                </span>
            </div>
            <div class="none-box" style="height: 10px; clear:left;"></div>
            <div id="user-table">

            </div>
            포스팅 테스트 (나중에 삭제)
            <input id="foodname" placeholder="음식이름">
            <input id="comment" placeholder="한마디">
            <input id="foodurl" placeholder="url">
            <input id="tagname1" placeholder="tag">
            <button onclick="saveFoodRecomend()">저장</button>
        </div>
    </main>
    <footer class="text-muted py-5" id="footer" style="background-color: #222529; height: 140px">
        <div class="container" >
            <p class="float-end mb-1">
                <a href="#">Back to top</a>
            </p>
            <p style="color:white; font-size: 11pt; text-decoration: none; ">
                <strong>오늘 뭐 먹지?</strong> made by
                <a href="https://github.com/bestmealever" style="text-decoration: none; color:white;">이거사조</a>. <br>
                이거사조 is Team 4 in 내일배움캠프. <br>
                Welcome to <a href="https://spartacodingclub.kr/" style="text-decoration: none; color:white;">스파르타코딩클럽</a>.
            </p>
        </div>
    </footer>
</div>
</body>
</html>
